@model AddNewTaskModel
@{
    Layout = "_UserLayout";
}
<link rel="stylesheet" href="~/css/add-book.css" />
<main class="flex-1 overflow-x-hidden overflow-y-auto md:mr-64 p-6 transition-all duration-300">

    <!-- 3. Forms Section - Expanded with more input types -->
    <section id="forms-section" class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">فرم اضافه کردن تسک</h2>
        <div class="card p-6">
            <form id="myForm" asp-controller="Todo" asp-action="Add" method="post" enctype='multipart/form-data'>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">

                    <!-- First Name -->
                    <div>
                        <label asp-for="@Model.NewTodo.Title" class="block text-sm font-medium text-gray-700 mb-1">عنوان</label>
                        <input type="text" asp-for="@Model.NewTodo.Title"  placeholder=""
                               class="mt-1 p-3 block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                    </div>

                    <div>
                        <label asp-for="@Model.NewTodo.CategoryId" class="block text-sm font-medium text-gray-700 mb-1">انتخاب دسته بندی</label>
                        <select asp-for="@Model.NewTodo.CategoryId"
                                class="mt-1 p-3 block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 bg-white">
                            <option value="" disabled selected>انتخاب دسته بندی</option>
                            @foreach (var category in Model.Categories)
                            {
                                <option value=@category.Id>@category.Title</option>
                            }

                        </select>
                    </div>
                    <!-- ✅ تاریخ سررسید -->
                    <div>
                        <label asp-for="@Model.NewTodo.DueDateShamsi" for="dueDatePicker" class="...">تاریخ سررسید</label>
                        <input type="text" id="dueDatePicker" asp-for="@Model.NewTodo.DueDateShamsi"
                               class="..." placeholder="مثلاً 1403/08/20" autocomplete="off" />
                    </div>



                    <!-- Submit Button -->
                    <div class="flex justify-end">
                        <button type="submit"
                                class="w-full sm:w-auto px-8 py-3 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                            ثبت نهایی اطلاعات
                        </button>
                    </div>
                    <div class="d-grid mb-2">

                        <div style="color:red">@ViewBag.Error</div>

                    </div>
                </div>
            </form>
        </div>
    </section>
</main>

@section Scripts {
    <!-- CDN Persian Datepicker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>

    <script>
        $(function () {

            // مقداردهی تقویم شمسی
            $("#dueDatePicker").persianDatepicker({
                format: 'YYYY/MM/DD',
                persianNumbers: true,   // اعداد فارسی نمایش داده شوند
                autoClose: true,
                initialValue: false
            });

            // تابع تبدیل اعداد فارسی به انگلیسی
            function convertPersianToEnglish(str) {
                if (!str) return str;
                const map = { '۰':'0','۱':'1','۲':'2','۳':'3','۴':'4','۵':'5','۶':'6','۷':'7','۸':'8','۹':'9' };
                return str.replace(/[۰-۹]/g, w => map[w]);
            }

            // هنگام ارسال فرم
            $("#myForm").on("submit", function () {
                const dateVal = $("#dueDatePicker").val();
                const englishDate = convertPersianToEnglish(dateVal);
                $("#dueDatePicker").val(englishDate);
                // console.log("Date sent to controller:", englishDate);
            });

        });
    </script>
}




